<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindful Companion</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #7c3aed;
            --primary-light: rgba(124, 58, 237, 0.1);
            --secondary-color: #10b981;
            --user-message-bg: #7c3aed;
            --bot-message-bg: #ffffff;
            --text-dark: #1f2937;
            --text-light: #ffffff;
            --text-gray: #6b7280;
            --border-color: #e5e7eb;
            --input-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --message-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.2s ease;
        }

        body {
            font-family: "Inter", sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #fae8ff 100%);
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .chat-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            max-width: 1200px;
            margin: 0 auto;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.05);
            background: rgba(255, 255, 255, 0.8);
        }

        .chat-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            color: var(--text-dark);
            padding: 18px 24px;
            text-align: center;
            position: relative;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
            box-shadow: var(--shadow);
        }

        .chat-header h1 {
            font-size: 22px;
            font-weight: 700;
            margin: 0;
            color: var(--primary-color);
            letter-spacing: -0.5px;
        }

        .chat-header p {
            font-size: 14px;
            color: var(--text-gray);
            margin-top: 4px;
        }

        .status-indicator {
            position: absolute;
            top: 24px;
            right: 24px;
            width: 10px;
            height: 10px;
            background: var(--secondary-color);
            border-radius: 50%;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }

        .chat-messages {
            flex: 1;
            background: transparent;
            padding: 24px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 16px 20px;
            border-radius: 18px;
            font-size: 15px;
            line-height: 1.5;
            position: relative;
            box-shadow: var(--message-shadow);
        }

        .user .message-content {
            background: var(--user-message-bg);
            color: var(--text-light);
            border-bottom-right-radius: 6px;
        }

        .bot .message-content {
            background: var(--bot-message-bg);
            color: var(--text-dark);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 6px;
        }

        .bot .message-content ul {
            padding-left: 24px;
            margin: 12px 0;
        }

        .bot .message-content li {
            margin-bottom: 10px;
            position: relative;
            padding-left: 8px;
        }

        .bot .message-content li:before {
            content: "â€¢";
            position: absolute;
            left: -15px;
            top: 0;
            color: var(--primary-color);
            font-size: 18px;
        }

        .bot .message-content li strong {
            color: var(--primary-color);
            font-weight: 600;
        }

        .bot .message-content .nested-list {
            padding-left: 20px;
            margin-top: 8px;
        }

        .bot .message-content .nested-list li:before {
            content: "â—¦";
            color: var(--secondary-color);
        }

        .message-typing {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background: var(--bot-message-bg);
            border-radius: 18px;
            width: fit-content;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            box-shadow: var(--message-shadow);
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--primary-color);
            border-radius: 50%;
            margin: 0 4px;
            opacity: 0.6;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.6; }
            30% { transform: translateY(-4px); opacity: 1; }
        }

        .chat-input-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px 24px;
            border-top: 1px solid var(--border-color);
            position: relative;
            flex-shrink: 0;
        }

        .chat-input-wrapper {
            display: flex;
            align-items: center;
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            padding: 0 16px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            box-shadow: var(--shadow);
        }

        .emoji-button {
            background: transparent;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            color: var(--text-gray);
            transition: all 0.2s;
        }

        .emoji-button:hover {
            color: var(--primary-color);
            transform: scale(1.1);
        }

        .chat-input {
            flex: 1;
            padding: 14px 0;
            border: none;
            background: transparent;
            font-size: 15px;
            outline: none;
            color: var(--text-dark);
        }

        .chat-input::placeholder {
            color: var(--text-gray);
        }

        .send-button {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s;
        }

        .send-button:hover {
            background: #6d28d9;
            transform: translateY(-2px);
        }

       
        .emoji-picker {
             position: absolute;
             bottom: 80px;
             right: 30px;
             background: white;
             border-radius: 12px;
             box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 12px;
            display: none;
            grid-template-columns: repeat(8, 1fr);
            gap: 6px;
            width: 300px;
            z-index: 100;
            border: 1px solid var(--border-color);

    /* Animation setup */
    opacity: 0;
    transform: translateX(100%);
    transition: transform 0.3s ease, opacity 0.3s ease;
}

.emoji-picker.active {
    display: grid;
    opacity: 1;
    transform: translateX(0);
}

        .emoji {
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            text-align: center;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .emoji:hover {
            background: var(--primary-light);
            transform: scale(1.2);
        }

        .welcome-message {
            text-align: center;
            margin: 20px 0 30px;
            padding: 0;
        }

        .welcome-message h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-dark);
            background: linear-gradient(135deg, #7c3aed 0%, #10b981 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-message p {
            font-size: 16px;
            color: var(--text-gray);
            margin-bottom: 24px;
        }

        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin-top: 24px;
        }

        .suggestion-chip {
            background: rgba(255, 255, 255, 0.9);
            color: var(--primary-color);
            padding: 12px 20px;
            border-radius: 24px;
            font-size: 14px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
            box-shadow: var(--shadow);
        }

        .suggestion-chip:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(124, 58, 237, 0.2);
        }

        .error-message {
            background: #fee2e2;
            color: #ef4444;
            padding: 12px 20px;
            border-radius: 12px;
            text-align: center;
            margin: 10px 0;
            font-size: 14px;
            border-left: 4px solid #ef4444;
        }

        /* Animation for new messages */
        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message {
            animation: messageAppear 0.3s ease-out;
        }

        /* Custom scrollbar */
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .message-content {
                max-width: 85%;
            }
            
            .suggestions {
                flex-direction: column;
                align-items: center;
            }
            
            .suggestion-chip {
                width: 100%;
                text-align: center;
            }
            
            .chat-input-wrapper {
                width: 95%;
            }
            
            .chat-header {
                padding: 16px;
            }
            
            .chat-messages {
                padding: 16px;
            }
            
            .chat-input-container {
                padding: 16px;
            }
            
            .welcome-message h2 {
                font-size: 24px;
            }
            
            .emoji-picker {
                width: 280px;
                right: 10px;
                grid-template-columns: repeat(7, 1fr);
            }
        }
    </style>
</head>
<body>

<div class="chat-container">
    <div class="chat-header">
        <div class="status-indicator"></div>
        <h1>Mindful Companion</h1>
        <p>Your mental wellness assistant</p>
    </div>
    
    <div class="chat-messages">
        <div class="welcome-message">
            <h2>Hello there! ğŸ‘‹</h2>
            <p>I'm here to support your mental wellness journey. How can I help you today?</p>
            
            <div class="suggestions">
                <div class="suggestion-chip">I'm feeling anxious ğŸ˜°</div>
                <div class="suggestion-chip">Stress management tips ğŸ§˜</div>
                <div class="suggestion-chip">How to improve sleep? ğŸ˜´</div>
                <div class="suggestion-chip">I need motivation ğŸ’ª</div>
            </div>
        </div>
    </div>
    
    <div class="chat-input-container">
        <div class="emoji-picker" id="emojiPicker">
            <span class="emoji">ğŸ˜€</span>
            <span class="emoji">ğŸ˜ƒ</span>
            <span class="emoji">ğŸ˜„</span>
            <span class="emoji">ğŸ˜</span>
            <span class="emoji">ğŸ˜†</span>
            <span class="emoji">ğŸ˜…</span>
            <span class="emoji">ğŸ˜‚</span>
            <span class="emoji">ğŸ¤£</span>
            <span class="emoji">ğŸ˜Š</span>
            <span class="emoji">ğŸ˜‡</span>
            <span class="emoji">ğŸ™‚</span>
            <span class="emoji">ğŸ™ƒ</span>
            <span class="emoji">ğŸ˜‰</span>
            <span class="emoji">ğŸ˜Œ</span>
            <span class="emoji">ğŸ˜</span>
            <span class="emoji">ğŸ¥°</span>
            <span class="emoji">ğŸ˜˜</span>
            <span class="emoji">ğŸ˜—</span>
            <span class="emoji">ğŸ˜™</span>
            <span class="emoji">ğŸ˜š</span>
            <span class="emoji">ğŸ˜‹</span>
            <span class="emoji">ğŸ˜›</span>
            <span class="emoji">ğŸ˜</span>
            <span class="emoji">ğŸ˜œ</span>
            <span class="emoji">ğŸ¤ª</span>
            <span class="emoji">ğŸ¤¨</span>
            <span class="emoji">ğŸ§</span>
            <span class="emoji">ğŸ¤“</span>
            <span class="emoji">ğŸ˜</span>
            <span class="emoji">ğŸ¤©</span>
            <span class="emoji">ğŸ¥³</span>
            <span class="emoji">ğŸ˜</span>
            <span class="emoji">ğŸ˜’</span>
            <span class="emoji">ğŸ˜</span>
            <span class="emoji">ğŸ˜”</span>
            <span class="emoji">ğŸ˜Ÿ</span>
            <span class="emoji">ğŸ˜•</span>
            <span class="emoji">ğŸ™</span>
            <span class="emoji">â˜¹ï¸</span>
            <span class="emoji">ğŸ˜£</span>
            <span class="emoji">ğŸ˜–</span>
            <span class="emoji">ğŸ˜«</span>
            <span class="emoji">ğŸ˜©</span>
            <span class="emoji">ğŸ¥º</span>
            <span class="emoji">ğŸ˜¢</span>
            <span class="emoji">ğŸ˜­</span>
            <span class="emoji">ğŸ˜¤</span>
            <span class="emoji">ğŸ˜ </span>
            <span class="emoji">ğŸ˜¡</span>
            <span class="emoji">ğŸ¤¬</span>
            <span class="emoji">ğŸ¤¯</span>
            <span class="emoji">ğŸ˜³</span>
            <span class="emoji">ğŸ¥µ</span>
            <span class="emoji">ğŸ¥¶</span>
            <span class="emoji">ğŸ˜±</span>
            <span class="emoji">ğŸ˜¨</span>
            <span class="emoji">ğŸ˜°</span>
            <span class="emoji">ğŸ˜¥</span>
            <span class="emoji">ğŸ˜“</span>
            <span class="emoji">ğŸ«£</span>
            <span class="emoji">ğŸ¤—</span>
            <span class="emoji">ğŸ«¡</span>
            <span class="emoji">ğŸ¤”</span>
            <span class="emoji">ğŸ«¢</span>
            <span class="emoji">ğŸ¤­</span>
            <span class="emoji">ğŸ¤«</span>
            <span class="emoji">ğŸ¤¥</span>
            <span class="emoji">ğŸ˜¶</span>
            <span class="emoji">ğŸ« </span>
            <span class="emoji">ğŸ˜¶â€ğŸŒ«ï¸</span>
            <span class="emoji">ğŸ’€</span>
            <span class="emoji">ğŸ‘»</span>
            <span class="emoji">ğŸ’©</span>
            <span class="emoji">ğŸ˜º</span>
            <span class="emoji">ğŸ˜¸</span>
            <span class="emoji">ğŸ˜¹</span>
            <span class="emoji">ğŸ˜»</span>
            <span class="emoji">ğŸ˜¼</span>
            <span class="emoji">ğŸ˜½</span>
            <span class="emoji">ğŸ™€</span>
            <span class="emoji">ğŸ˜¿</span>
            <span class="emoji">ğŸ˜¾</span>
        </div>
        <div class="chat-input-wrapper">
            <button class="emoji-button" id="emojiButton">ğŸ˜Š</button>
            <input class="chat-input" placeholder="Type your message here..." type="text" id="messageInput">
            <button class="send-button" id="sendButton"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</div>

<script type="importmap">
{
  "imports": {
    "@google/generative-ai": "https://esm.run/@google/generative-ai"
  }
}
</script>

<script type="module">
import { GoogleGenerativeAI } from "@google/generative-ai";

const API_KEY = "AIzaSyAAY2Rzyhx3Wq42IDselKl7exS6cdKbs3E";

const systemPrompt = `
You are a calm and supportive mental wellness assistant.
Respond empathetically and provide helpful guidance to users.
When providing advice or tips, always format them as bullet points for better readability.
Keep your responses clear and structured.
Use appropriate emojis in your responses to make them more engaging and friendly.
`;

const genAI = new GoogleGenerativeAI(API_KEY);
const model = genAI.getGenerativeModel({ 
    model: "gemini-2.0-flash",
    systemInstruction: systemPrompt
});

let messages = { history: [] };

const chatMessages = document.querySelector('.chat-messages');
const inputEl = document.getElementById('messageInput');
const sendButton = document.getElementById('sendButton');
const emojiButton = document.getElementById('emojiButton');
const emojiPicker = document.getElementById('emojiPicker');
const suggestionChips = document.querySelectorAll('.suggestion-chip');

// Toggle emoji picker
emojiButton.addEventListener('click', () => {
    emojiPicker.classList.toggle('active');
});

// Add emoji to input
document.querySelectorAll('.emoji').forEach(emoji => {
    emoji.addEventListener('click', () => {
        inputEl.value += emoji.textContent;
        inputEl.focus();
    });
});

// Close emoji picker when clicking outside
document.addEventListener('click', (e) => {
    if (!emojiButton.contains(e.target) && !emojiPicker.contains(e.target)) {
        emojiPicker.classList.remove('active');
    }
});

function showTypingIndicator() {
    const typingElement = document.createElement('div');
    typingElement.className = 'message-typing';
    typingElement.innerHTML = `
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
    `;
    chatMessages.appendChild(typingElement);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    return typingElement;
}

function removeTypingIndicator(typingElement) {
    if (typingElement && typingElement.parentNode) {
        typingElement.parentNode.removeChild(typingElement);
    }
}

function formatResponse(text) {
    // Clean up any asterisks from the text
    text = text.replace(/\*\*/g, '');
    
    // Convert numbered lists to HTML lists
    text = text.replace(/(\d+)\.\s+(.*?)(?=\d+\.|$)/gs, '<li>$2</li>');
    
    // Convert bullet points to HTML lists
    text = text.replace(/([-â€¢*])\s+(.*?)(?=[-â€¢*]|$)/gs, '<li>$2</li>');
    
    // Wrap list items in ul tags if we find any list items
    if (text.includes('<li>')) {
        text = text.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
    }
    
    return text;
}

async function sendMessage() {
    const userMessage = inputEl.value.trim();
    if (!userMessage) return;

    inputEl.value = "";
    emojiPicker.classList.remove('active');
    
    const userMessageElement = document.createElement('div');
    userMessageElement.className = 'message user';
    userMessageElement.innerHTML = `<div class="message-content">${userMessage}</div>`;
    chatMessages.appendChild(userMessageElement);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    const typingElement = showTypingIndicator();

    try {
        const chat = model.startChat(messages);
        let result = await chat.sendMessageStream(userMessage);

        const botMessageElement = document.createElement('div');
        botMessageElement.className = 'message bot';
        botMessageElement.innerHTML = '<div class="message-content"></div>';
        chatMessages.appendChild(botMessageElement);
        
        removeTypingIndicator(typingElement);
        
        const messageContent = botMessageElement.querySelector('.message-content');
        
        let fullResponse = "";
        for await (const chunk of result.stream) {
            fullResponse += chunk.text();
            messageContent.innerHTML = formatResponse(fullResponse);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        messages.history.push({ role: "user", parts: [{ text: userMessage }] });
        messages.history.push({ role: "model", parts: [{ text: fullResponse }] });

    } catch (error) {
        removeTypingIndicator(typingElement);
        
        const errorElement = document.createElement('div');
        errorElement.className = 'error-message';
        errorElement.textContent = 'The message could not be sent. Please try again.';
        chatMessages.appendChild(errorElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        console.error('Error sending message:', error);
    }
}

sendButton.addEventListener('click', sendMessage);
inputEl.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendMessage();
});

suggestionChips.forEach(chip => {
    chip.addEventListener('click', () => {
        inputEl.value = chip.textContent;
        sendMessage();
    });
});

window.addEventListener('load', () => {
    inputEl.focus();
});
</script>

</body>
</html>